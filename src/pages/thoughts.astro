---
import Layout from "../layouts/Layout.astro";
import art from "../assets/brand/art-thoughts.png";
import { getThoughts } from "../lib/notion";

// Fetch posts from Notion
const posts = await getThoughts();

// Group posts by year (adjusted for new date format)
const years = [...new Set(posts.map(post => new Date(post.date).getFullYear()))].sort((a, b) => b - a);
---

<Layout
  pageTitle="Thoughts - Karina Tovar"
  pageDescription="Pixel Philosopher Cautious Technologist"
  eyelash_text="Diary of a pixel philosopher"
  title_text="Mental notes and deep thoughts"
  header_visual_image={art}
  header_visual_alt_text="Tools"
  header_visual_classes="mt-10 mix-blend-multiply"
  header_visual_width={280}
>
  <div class="divider--large"></div>

  <section
    class="w-full max-w-5xl h-full mx-auto content-section flex items-start justify-between gap-10"
  >
    <div
      class="w-1/3 max-w-[200px] [&>p]:text-sm [&>p]:text-ink-secondary [&>p]:mb-2"
    >
      <h3 class="mb-4 text-sm">Side notes</h3>
      <p>Ruby on Rails</p>
      <p>Better prompts</p>
    </div>

    <div class="flex-1 flex flex-col items-start gap-5">
      {years.map((year) => {
        const postsForYear = posts.filter(
          (post) => new Date(post.date).getFullYear() === year
        );
        return (
          <>
            <div class="w-full flex items-center justify-between flex-wrap px-2 [&:not(:first-child)]:mt-20">
              <h2>{year}</h2>
              <p class="text-ink-secondary text-base">
                {postsForYear.length} published thoughts
              </p>
            </div>
            <ul class="w-full flex flex-col items-start mt-2.5 [&>li]:w-full">
              {postsForYear.map((post) => (
                <li class="group">
                  <a 
                    href={post.href} 
                    class="w-full flex items-center gap-2 justify-between text-base outline-none transition-all duration-300 px-2 py-5 border-b border-dashed border-stone-200 hover:bg-paper-green/50 hover:px-4"
                  >
                    <span class="text-ink-primary group-hover:underline underline-offset-4">
                      {post.title}
                    </span>
                    <div class="flex items-center justify-end gap-1 text-ink-secondary">
                      <span>{post.categories[0]}</span>
                      <span>Â·</span>
                      <span>{Math.ceil(post.content.length / 200)} mins</span>
                    </div>
                  </a>
                </li>
              ))}
            </ul>
          </>
        );
      })}
    </div>
  </section>

  <div class="divider--extra-large"></div>
</Layout>

