---
import { getThoughts } from "../../lib/notion";
import { getCollection, type CollectionEntry } from "astro:content";
import type { ThoughtPost } from "../../lib/notion";
import ArrowLeft from "phosphor-astro/ArrowLeft.astro";
import ArrowRight from "phosphor-astro/ArrowRight.astro";

interface Props {
  currentSlug: string;
}

// Get all posts from both sources
const notionPosts = await getThoughts();
const contentPosts = await getCollection("notebooks");

// Combine and sort all posts by date
const allPosts = [
  ...notionPosts.map((post: ThoughtPost) => ({
    title: post.title,
    date: post.date,
    href: post.href,
    slug: post.href.split("/").pop(),
  })),
  ...contentPosts.map((post: CollectionEntry<"notebooks">) => ({
    title: post.data.title,
    date: post.data.date,
    href: `/notebooks/${post.slug}`,
    slug: post.slug,
  })),
].sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());

const { currentSlug } = Astro.props;

// Find current post index
const currentIndex = allPosts.findIndex((post) => post.slug === currentSlug);
const prevPost =
  currentIndex < allPosts.length - 1 ? allPosts[currentIndex + 1] : null;
const nextPost = currentIndex > 0 ? allPosts[currentIndex - 1] : null;
---

<nav class="mt-20 flex justify-between items-center">
  {
    prevPost && (
      <a href={prevPost.href} class="group flex items-center gap-2 group">
        <ArrowLeft class="w-10 h-10 opacity-60 group-hover:text-purple-500" />
        <span class="text-sm">
          <span class="block opacity-60">Previous</span>
          <span class="block text-lg">{prevPost.title}</span>
        </span>
      </a>
    )
  }

  {
    nextPost && (
      <a
        href={nextPost.href}
        class="group flex items-center gap-2 group ml-auto"
      >
        <span class="text-sm text-right">
          <span class="block opacity-60">Next</span>
          <span class="block text-lg">{nextPost.title}</span>
        </span>
        <ArrowRight class="w-10 h-10 opacity-60 group-hover:text-purple-500" />
      </a>
    )
  }
</nav>

